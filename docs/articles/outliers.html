<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sastats">
<title> • sastats</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.4/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.4/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.4/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="sastats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sastats</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Example%20analysis.html">Example analysis</a>
    <a class="dropdown-item" href="../articles/errors.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../articles/outliers.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../articles/weight.html">UNKNOWN TITLE</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/southwick-associates/sastats/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/southwick-associates/sastats/blob/HEAD/vignettes/outliers.Rmd" class="external-link"><code>vignettes/outliers.Rmd</code></a></small>
      <div class="d-none name"><code>outliers.Rmd</code></div>
    </div>

    
    
<!-- .md is generated from .Rmd. Please edit that file -->
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Outliers should be considered when working with continuous survey
variables. There are no hard and fast rules for outlier identification,
but <a href="https://en.wikipedia.org/wiki/Outlier#Tukey%27s_fences" class="external-link">Tukey’s
Test</a> provides one method that is easy to apply in a standard way.
You can view a production example for <a href="https://github.com/southwick-associates/B4W-19-01/blob/master/code/svy/7-recode-outliers.R" class="external-link">B4W-19-01</a>.</p>
<p>Package sastats includes a few simple outlier functions:</p>
<ul>
<li>For visualizing: <code><a href="../reference/outlier_plot.html">outlier_plot()</a></code>
</li>
<li>For identification: <code><a href="../reference/outlier_tukey.html">outlier_tukey()</a></code>
</li>
<li>For top-coding: <code><a href="../reference/outlier_tukey.html">outlier_tukey_top()</a></code>
</li>
</ul>
<div class="section level4">
<h4 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h4>
<p>For demonstration, I included a survey dataset with annual
participation metrics for 9 outdoor recreation activities:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/southwick-associates/sastats" class="external-link">sastats</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">svy</span><span class="op">)</span> <span class="co"># list with 2 data frames: person, act</span></span>
<span><span class="va">activities</span> <span class="op">&lt;-</span> <span class="va">svy</span><span class="op">$</span><span class="va">act</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">activities</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 11,268</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; $ Vrid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "98", "99", "100", "101", "102", "103", "105", "106", "107", "108…</span></span>
<span><span class="co">#&gt; $ act  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "trail", "trail", "trail", "trail", "trail", "trail", "trail", "t…</span></span>
<span><span class="co">#&gt; $ part <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Unchecked", "Unchecked", "Unchecked", "Unchecked", "Unchecked", …</span></span>
<span><span class="co">#&gt; $ days <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, 15, 10, NA, 2, NA, NA, 10, NA, NA…</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h3>
<p>Visualizing the data is a good first step. We can use
<code><a href="../reference/outlier_plot.html">outlier_plot()</a></code> which is largely a wrapper for a few <a href="https://ggplot2.tidyverse.org/" class="external-link">ggplot2</a> functions. The
<code>ignore_zero = TRUE</code> specification ensures we exclude any
respondents who didn’t actually participate.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/outlier_plot.html">outlier_plot</a></span><span class="op">(</span><span class="va">activities</span>, <span class="va">days</span>, <span class="va">act</span>, ignore_zero <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="outliers_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>After running this function, we can see that the distributions are
highly skewed and difficult to view. Additionally, the position of the
whiskers suggests that we would be flagging many reasonable values as
outliers (e.g., those above 20 or so for fishing).</p>
<p>Log-transforming the y-axis (<code>apply_log = TRUE</code>) produces
more normal distributions, and likely provides a more reasonable
criteria for outlier identification. Note that we don’t need to supply
<code>ignore_zero = TRUE</code> since <code>log(0)</code> is
undefined.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/outlier_plot.html">outlier_plot</a></span><span class="op">(</span><span class="va">activities</span>, <span class="va">days</span>, <span class="va">act</span>, apply_log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="outliers_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="flag-outliers">Flag Outliers<a class="anchor" aria-label="anchor" href="#flag-outliers"></a>
</h3>
<p>We can use <code><a href="../reference/outlier_tukey.html">outlier_tukey()</a></code> to flag those values observed
to be outliers:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">activities</span> <span class="op">&lt;-</span> <span class="va">activities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">act</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        is_outlier <span class="op">=</span> <span class="fu"><a href="../reference/outlier_tukey.html">outlier_tukey</a></span><span class="op">(</span><span class="va">days</span>, apply_log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>        days_cleaned <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_outlier</span>, <span class="cn">NA</span>, <span class="va">days</span><span class="op">)</span> </span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/outlier_plot.html">outlier_plot</a></span><span class="op">(</span><span class="va">activities</span>, <span class="va">days</span>, <span class="va">act</span>, apply_log <span class="op">=</span> <span class="cn">TRUE</span>, show_outliers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="outliers_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>We also have a couple summary functions available to demonstrate the
effects of outlier removal:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/outlier_pct.html">outlier_pct</a></span><span class="op">(</span><span class="va">activities</span>, <span class="va">act</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   act [8]</span></span></span>
<span><span class="co">#&gt;   act      is_outlier     n pct_outliers</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> camp     TRUE           6       0.479 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> fish     TRUE           3       0.240 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> hunt     TRUE           1       0.079<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> picnic   TRUE          15       1.20  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> snow     TRUE           2       0.160 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> trail    TRUE           4       0.319 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> water    TRUE           4       0.319 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> wildlife TRUE          13       1.04</span></span>
<span></span>
<span><span class="fu"><a href="../reference/outlier_mean_compare.html">outlier_mean_compare</a></span><span class="op">(</span><span class="va">activities</span>, <span class="va">days</span>, <span class="va">days_cleaned</span>, <span class="va">act</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">#&gt;   act       days days_cleaned</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bike     31.6         31.6 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> camp     11.2          8.58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> fish     11.6          9.40</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> hunt      9.37         8.34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> picnic   17.5         13.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> snow      9.99         9.29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> trail    28.4         25.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> water    12.4         10.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> wildlife 30.5         21.8</span></span></code></pre></div>
<div class="section level4">
<h4 id="topcode">Topcode<a class="anchor" aria-label="anchor" href="#topcode"></a>
</h4>
<p>Instead of removing outliers, we could use
<code><a href="../reference/outlier_tukey.html">outlier_tukey_top()</a></code> to identify the topcode value and then
recode accordingly:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">activities</span> <span class="op">&lt;-</span> <span class="va">activities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">act</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        topcode_value <span class="op">=</span> <span class="fu"><a href="../reference/outlier_tukey.html">outlier_tukey_top</a></span><span class="op">(</span><span class="va">days</span>, apply_log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        days_cleaned <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">is_outlier</span>, <span class="va">topcode_value</span>, <span class="va">days</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/outlier_mean_compare.html">outlier_mean_compare</a></span><span class="op">(</span><span class="va">activities</span>, <span class="va">days</span>, <span class="va">days_cleaned</span>, <span class="va">act</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 3</span></span></span>
<span><span class="co">#&gt;   act       days days_cleaned</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bike     31.6         31.6 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> camp     11.2          9.30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> fish     11.6         10.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> hunt      9.37         9.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> picnic   17.5         15.8 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> snow      9.99         9.91</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> trail    28.4         28.1 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> water    12.4         11.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> wildlife 30.5         28.6</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dan Kary.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
